# Project name: Apollo Link
## General guidelines
* Use `pnpm` as the package manager.
* Use TypeScript.
* Use Redis and PostgreSQL as the databases.

## General project info
Apollo Link is the backend service for Apollo (standalone, AI-based voice assistant device, similar to Amazon Echo Show) and Apollo Link Companion (Flutter mobile app).

## How is this service used
* Apollo (the device) connects to the Apollo Link server authenticating as a genuine and official device (routers/device.ts), to later connect to a WebSocket "stream" (services/websocket.ts) on which the device communicates with the backend and receives events/notifications from the cloud.
* Apollo Link Companion app connects to the Apollo Link server to manage devices associated with user's account. The user has two login options — e-mail and password and Google (using the Google Sign-In native pop-up). After logging in the user can link a device by using a one-time QR code generated by Apollo Link and displayed on the device. The user can modify connected devices' settings, cast media to them and activate other features such as "remote wake" (activates listening without the need to touch the device or say the wakeword).

The point is to provide a quick and relayable connection between the mobile app and the device (for features such as modifying device settings remotely, casting/streaming media to the device, etc.), thus the use of websockets for events.

## Summary of project files
* index.ts — connects all different parts of the app, the main file.
* utils/db.ts — initialises database connections.
* utils/helpers.ts — self-explanatory.
* services/websocket.ts — websocket server Apollo device connects to to listen for events forwarded through Redis Pub/Sub from other parts of the app.
* routers/google.ts, routers/spotify.ts — handle Google Calendar and Spotify connections on the device, it initiates auth with an endpoint and then connects to an SSE feed (which delivers credentials and status to the device) while the user scans a QR code on the device which leads to the login page.
* routers/device.ts — device registration and authentication endpoints.
* public/* — self-explanatory, CSS files, images, etc.
* html/* — HTML files that are served manually by Express.